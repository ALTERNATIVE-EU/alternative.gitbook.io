
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://platform.alternative-project.eu/user-services/ckan/authentication/">
      
      
        <link rel="prev" href="../overview/">
      
      
        <link rel="next" href="../users/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.30">
    
    
      
        <title>Authentication - ALTERNATIVE Platform Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ckan-keycloak-authentication" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="ALTERNATIVE Platform Documentation" class="md-header__button md-logo" aria-label="ALTERNATIVE Platform Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ALTERNATIVE Platform Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Authentication
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="pink"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="pink"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ALTERNATIVE-EU/alternative.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ALTERNATIVE-EU/alternative.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="ALTERNATIVE Platform Documentation" class="md-nav__button md-logo" aria-label="ALTERNATIVE Platform Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    ALTERNATIVE Platform Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ALTERNATIVE-EU/alternative.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ALTERNATIVE-EU/alternative.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/cloud-infrastructure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cloud Infrastructure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/kubernetes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/networking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Networking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/storage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Storage
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    User Services
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            User Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CKAN
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            CKAN
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Authentication
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Authentication
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication Flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-login-flow" class="md-nav__link">
    <span class="md-ellipsis">
      1. Login Flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Login Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#login-flow-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      Login Flow Diagram:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-by-step-login-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Step-by-Step Login Flow:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-identify-user-verification-flow" class="md-nav__link">
    <span class="md-ellipsis">
      2. Identify (User Verification) Flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Identify (User Verification) Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#identify-flow-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      Identify Flow Diagram:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-by-step-identity-verification-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Step-by-Step Identity Verification Flow:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-logout-flow" class="md-nav__link">
    <span class="md-ellipsis">
      3. Logout Flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Logout Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#logout-flow-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      Logout Flow Diagram:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-by-step-logout-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Step-by-Step Logout Flow:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grant-type-authorization-code-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Grant Type: Authorization Code Flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Grant Type: Authorization Code Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-points" class="md-nav__link">
    <span class="md-ellipsis">
      Key Points:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validation-of-access-tokens-jwt-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      Validation of Access Tokens (JWT Tokens)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Validation of Access Tokens (JWT Tokens)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#token-refresh-process" class="md-nav__link">
    <span class="md-ellipsis">
      Token Refresh Process:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimizations" class="md-nav__link">
    <span class="md-ellipsis">
      Optimizations:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../users/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Users, Organizations, and Authorization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../datasets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Datasets, Resources, and Groups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../metadata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Metadata
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../extensions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Extensions
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    JupyterHub
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            JupyterHub
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../jupyterhub/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../jupyterhub/filesystem/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    File System
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../jupyterhub/environments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Environments
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../jupyterhub/library/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Alternative Library
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../jupyterhub/r/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    R
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../jupyterhub/bioconductor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bioconductor
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    AI/ML API
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            AI/ML API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-ml-api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-ml-api/system-architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    System Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-ml-api/data-flow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Flow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_4_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4_4" id="__nav_3_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Security
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_4">
            <span class="md-nav__icon md-icon"></span>
            Security
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-ml-api/security/authentication-and-authorization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authentication and Authorization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-ml-api/security/encryption/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Encryption
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_4_5" >
        
          
          <label class="md-nav__link" for="__nav_3_4_5" id="__nav_3_4_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Token Management
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_5">
            <span class="md-nav__icon md-icon"></span>
            Token Management
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-ml-api/token-management/ckan-integration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CKAN Integration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-ml-api/token-management/token-lifecycle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Token Lifecycle
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_4_6" >
        
          
          <label class="md-nav__link" for="__nav_3_4_6" id="__nav_3_4_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API Usage
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_6">
            <span class="md-nav__icon md-icon"></span>
            API Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-ml-api/api-usage/endpoints/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Endpoints
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-ml-api/api-usage/authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-ml-api/api-usage/error-handling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Error Handling
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-ml-api/scalability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scalability
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-ml-api/testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testing
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Administrative Services
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Administrative Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../admin-services/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../admin-services/keycloak/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Keycloak
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../admin-services/external-dns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    External DNS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../admin-services/cert-manager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cert Manager
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../admin-services/ingress-controller/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ingress Controller
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../admin-services/istio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Istio
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Platform Features
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Platform Features
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/data-sharing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Sharing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/development-environment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Development Environment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/multi-user-and-collaboration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multi-user and Collaboration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/sso/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Single Sign-On
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/elasticity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Elasticity
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Deployment
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Deployment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../deployment/platform/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Platform Deployment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../deployment/envoy-filter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Envoy Filter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../deployment/ai-ml-api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AI/ML API
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../repositories/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Repositories
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication Flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-login-flow" class="md-nav__link">
    <span class="md-ellipsis">
      1. Login Flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Login Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#login-flow-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      Login Flow Diagram:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-by-step-login-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Step-by-Step Login Flow:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-identify-user-verification-flow" class="md-nav__link">
    <span class="md-ellipsis">
      2. Identify (User Verification) Flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Identify (User Verification) Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#identify-flow-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      Identify Flow Diagram:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-by-step-identity-verification-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Step-by-Step Identity Verification Flow:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-logout-flow" class="md-nav__link">
    <span class="md-ellipsis">
      3. Logout Flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Logout Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#logout-flow-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      Logout Flow Diagram:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-by-step-logout-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Step-by-Step Logout Flow:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grant-type-authorization-code-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Grant Type: Authorization Code Flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Grant Type: Authorization Code Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-points" class="md-nav__link">
    <span class="md-ellipsis">
      Key Points:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validation-of-access-tokens-jwt-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      Validation of Access Tokens (JWT Tokens)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Validation of Access Tokens (JWT Tokens)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#token-refresh-process" class="md-nav__link">
    <span class="md-ellipsis">
      Token Refresh Process:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimizations" class="md-nav__link">
    <span class="md-ellipsis">
      Optimizations:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="ckan-keycloak-authentication">CKAN Keycloak Authentication<a class="headerlink" href="#ckan-keycloak-authentication" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>The ckanext-keycloak_auth is a CKAN extension that integrates Keycloak for authentication and user management, leveraging OAuth2 for secure login and user session management.</p>
<h2 id="authentication-flow">Authentication Flow<a class="headerlink" href="#authentication-flow" title="Permanent link">&para;</a></h2>
<h3 id="1-login-flow">1. <strong>Login Flow</strong><a class="headerlink" href="#1-login-flow" title="Permanent link">&para;</a></h3>
<p>The login process consists of a series of steps that take the user from unauthenticated to authenticated status within the system. This process leverages <strong>OAuth2 with Keycloak as the identity provider</strong>.</p>
<h4 id="login-flow-diagram">Login Flow Diagram:<a class="headerlink" href="#login-flow-diagram" title="Permanent link">&para;</a></h4>
<p><img alt="Login Flow" src="../../images/login.png" /></p>
<h4 id="step-by-step-login-flow">Step-by-Step Login Flow:<a class="headerlink" href="#step-by-step-login-flow" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>User Initiates Login</strong>:</li>
<li>
<p>The user clicks the "Login" button at the top of the CKAN page.</p>
</li>
<li>
<p><strong>Redirection to Keycloak</strong>:</p>
</li>
<li>CKAN constructs a URL pointing to the Keycloak authorization endpoint.</li>
<li>The URL includes <code>client_id</code>, <code>redirect_uri</code>, <code>response_type=code</code>, and <code>scope=openid</code>.</li>
<li>
<p>CKAN redirects the user to this Keycloak URL.</p>
</li>
<li>
<p><strong>Keycloak Authentication</strong>:</p>
</li>
<li>The user is presented with Keycloak's login form.</li>
<li>
<p>The user enters their credentials (username and password) and submits the form.</p>
</li>
<li>
<p><strong>Credential Validation</strong>:</p>
</li>
<li>
<p>Keycloak internally validates the user's credentials.</p>
</li>
<li>
<p><strong>Authorization Code Generation</strong>:</p>
</li>
<li>Upon successful authentication, Keycloak generates an authorization code.</li>
<li>
<p>Keycloak redirects the user back to CKAN's specified <code>redirect_uri</code> with the authorization code.</p>
</li>
<li>
<p><strong>Authorization Code Received</strong>:</p>
</li>
<li>
<p>The user's browser sends a request to CKAN with the authorization code.</p>
</li>
<li>
<p><strong>Token Exchange Request</strong>:</p>
</li>
<li>CKAN sends a server-to-server POST request to Keycloak's token endpoint.</li>
<li>
<p>CKAN exchanges the authorization code for access and refresh tokens.</p>
</li>
<li>
<p><strong>Token Response</strong>:</p>
</li>
<li>
<p>Keycloak responds to CKAN with the access and refresh tokens.</p>
</li>
<li>
<p><strong>Session ID Generation</strong>:</p>
</li>
<li>
<p>CKAN generates a secure session ID for the user.</p>
</li>
<li>
<p><strong>Database Storage</strong>:</p>
<ul>
<li>CKAN stores the session ID, access token, and refresh token in its database.</li>
</ul>
</li>
<li>
<p><strong>Storage Confirmation</strong>:</p>
<ul>
<li>The database acknowledges successful storage of the session information.</li>
</ul>
</li>
<li>
<p><strong>Cache Storage</strong>:</p>
<ul>
<li>CKAN stores the session information (session ID, access token, refresh token) in the session cache.</li>
</ul>
</li>
<li>
<p><strong>Cache Confirmation</strong>:</p>
<ul>
<li>The session cache acknowledges successful caching of the session information.</li>
</ul>
</li>
<li>
<p><strong>Cookie Setting</strong>:</p>
<ul>
<li>CKAN sets a <code>session_id</code> cookie in the user's browser.</li>
</ul>
</li>
<li>
<p><strong>Final Redirection</strong>:</p>
<ul>
<li>The user is redirected to the CKAN interface, now logged in and authenticated.</li>
</ul>
</li>
</ol>
<hr />
<h3 id="2-identify-user-verification-flow">2. <strong>Identify (User Verification) Flow</strong><a class="headerlink" href="#2-identify-user-verification-flow" title="Permanent link">&para;</a></h3>
<p>Once the user is logged in, CKAN needs to verify their identity on each request to ensure the user is authorized to access the requested resources. This is handled by inspecting the session and validating the access token.</p>
<h4 id="identify-flow-diagram">Identify Flow Diagram:<a class="headerlink" href="#identify-flow-diagram" title="Permanent link">&para;</a></h4>
<p><img alt="Identify Flow" src="../../images/identify.png" /></p>
<h4 id="step-by-step-identity-verification-flow">Step-by-Step Identity Verification Flow:<a class="headerlink" href="#step-by-step-identity-verification-flow" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>User Sends a Request</strong>:</li>
<li>The user navigates the CKAN site, making a request (e.g., visiting a dataset page).</li>
<li>
<p>The request includes the <code>session_id</code> cookie.</p>
</li>
<li>
<p><strong>Session Lookup</strong>:</p>
</li>
<li>CKAN queries the session cache using the <code>session_id</code>.</li>
<li>If the session is in the cache:<ul>
<li>2.1. The cache returns the cached session information.</li>
</ul>
</li>
<li>
<p>If the session is not in the cache:</p>
<ul>
<li>2.2. CKAN queries the database for the session information.</li>
<li>2.3. The database returns the session with Access Token and Refresh Token.</li>
<li>2.4. CKAN stores the session information in the cache.</li>
<li>2.5. The cache acknowledges successful caching.</li>
</ul>
</li>
<li>
<p><strong>Token Header Extraction</strong>:</p>
</li>
<li>
<p>CKAN extracts the 'kid' (Key ID) from the Access Token header.</p>
</li>
<li>
<p><strong>Public Key Retrieval</strong>:</p>
</li>
<li>CKAN queries the Public Key Cache using the 'kid'.</li>
<li>If the public key is in the cache:<ul>
<li>4.1. The cache returns the cached public key.</li>
</ul>
</li>
<li>
<p>If the public key is not in the cache:</p>
<ul>
<li>4.2. CKAN fetches the JWKS (JSON Web Key Set) from Keycloak.</li>
<li>4.3. Keycloak returns the JWKS.</li>
<li>4.4. CKAN extracts the public key for the specific 'kid'.</li>
<li>4.5. CKAN stores the public key in the cache.</li>
<li>4.6. The cache acknowledges successful caching of the public key.</li>
</ul>
</li>
<li>
<p><strong>Access Token Validation</strong>:</p>
</li>
<li>CKAN validates the Access Token using the public key.</li>
<li>If the Access Token is valid:<ul>
<li>5.1. CKAN serves the user's request.</li>
</ul>
</li>
<li>If the Access Token has expired:<ul>
<li>5.2. CKAN requests new tokens from Keycloak using the Refresh Token.</li>
<li>5.3. Keycloak returns new Access and Refresh Tokens.</li>
<li>5.4. CKAN updates the session in the database with the new tokens.</li>
<li>5.5. The database acknowledges the update.</li>
<li>5.6. CKAN updates the cached session information.</li>
<li>5.7. The cache acknowledges the update.</li>
<li>5.8. CKAN serves the user's request.</li>
</ul>
</li>
<li>If the Refresh Token is invalid:<ul>
<li>5.9. CKAN deletes the session from the database.</li>
<li>5.10. The database acknowledges the session deletion.</li>
<li>5.11. CKAN deletes the cached session.</li>
<li>5.12. The cache acknowledges the deletion.</li>
<li>5.13. CKAN redirects the user to the login page.</li>
</ul>
</li>
</ol>
<hr />
<h3 id="3-logout-flow">3. <strong>Logout Flow</strong><a class="headerlink" href="#3-logout-flow" title="Permanent link">&para;</a></h3>
<p>When a user logs out, the system must invalidate the session both in CKAN and in Keycloak, and ensure the user is no longer able to access protected resources.</p>
<h4 id="logout-flow-diagram">Logout Flow Diagram:<a class="headerlink" href="#logout-flow-diagram" title="Permanent link">&para;</a></h4>
<p><img alt="Logout Flow" src="../../images/logout.png" /></p>
<h4 id="step-by-step-logout-flow">Step-by-Step Logout Flow:<a class="headerlink" href="#step-by-step-logout-flow" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>User Initiates Logout</strong>:</li>
<li>
<p>The user clicks the "Logout" button in the CKAN interface.</p>
</li>
<li>
<p><strong>Database Session Deletion</strong>:</p>
</li>
<li>
<p>CKAN sends a request to delete the session from the database using the session_id.</p>
</li>
<li>
<p><strong>Database Acknowledgment</strong>:</p>
</li>
<li>
<p>The database acknowledges the successful deletion of the session.</p>
</li>
<li>
<p><strong>Cache Session Deletion</strong>:</p>
</li>
<li>
<p>CKAN delete the cached session from the Session Cache.</p>
</li>
<li>
<p><strong>Cache Acknowledgment</strong>:</p>
</li>
<li>
<p>The Session Cache acknowledges the successful deletion of the cached session.</p>
</li>
<li>
<p><strong>Cookie Deletion</strong>:</p>
</li>
<li>
<p>CKAN deletes the session_id cookie from the user's browser.</p>
</li>
<li>
<p><strong>Keycloak Logout Redirection</strong>:</p>
</li>
<li>
<p>CKAN redirects the user to the Keycloak logout endpoint.</p>
</li>
<li>
<p><strong>Keycloak Session Invalidation</strong>:</p>
</li>
<li>
<p>Keycloak invalidates its own session for the user.</p>
</li>
<li>
<p><strong>User Redirection to CKAN</strong>:</p>
</li>
<li>
<p>Keycloak redirects the user back to CKAN (typically to the homepage or a logout confirmation page).</p>
</li>
<li>
<p><strong>Logout Completion</strong>:</p>
<ul>
<li>The user arrives at CKAN, now fully logged out.</li>
</ul>
</li>
</ol>
<hr />
<h3 id="grant-type-authorization-code-flow"><strong>Grant Type: Authorization Code Flow</strong><a class="headerlink" href="#grant-type-authorization-code-flow" title="Permanent link">&para;</a></h3>
<p>The <strong>Authorization Code Grant</strong> is used for the login flow. This is the most secure OAuth2 flow for server-side applications, where the application exchanges an <strong>Authorization Code</strong> for an <strong>Access Token</strong> and a <strong>Refresh Token</strong>.</p>
<h4 id="key-points"><strong>Key Points:</strong><a class="headerlink" href="#key-points" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Authorization Code</strong>: This is a short-lived code that can only be exchanged for tokens when sent via the backend (to protect from exposure).</li>
<li><strong>Access Token</strong>: A JWT that contains user identity and permissions, used to authenticate the user for each request.</li>
<li><strong>Refresh Token</strong>: Used to obtain a new access token without re-authentication, ensuring seamless user experience after token expiration.</li>
</ul>
<p><strong>Why Authorization Code Grant is Used:</strong>
- <strong>Security</strong>: Tokens are not exposed in the browser.
- <strong>Server-side Token Management</strong>: CKAN securely manages access and refresh tokens, reducing the risk of token leaks.</p>
<hr />
<h3 id="validation-of-access-tokens-jwt-tokens"><strong>Validation of Access Tokens (JWT Tokens)</strong><a class="headerlink" href="#validation-of-access-tokens-jwt-tokens" title="Permanent link">&para;</a></h3>
<p>The <strong>Access Token</strong> issued by Keycloak is a <strong>JWT (JSON Web Token)</strong>, which is validated locally by CKAN without needing to contact Keycloak for every request. The token contains information about the user and the session and is validated using the following checks:</p>
<ol>
<li><strong>Token Signature Validation</strong>:</li>
<li>
<p>The token’s signature is verified using Keycloak's public key, ensuring the token was issued by Keycloak and has not been tampered with. CKAN fetches the public key from Keycloak’s JWKS (JSON Web Key Set) endpoint.</p>
</li>
<li>
<p><strong>Expiration Time (exp)</strong>:</p>
</li>
<li>The <code>exp</code> claim inside the token specifies the expiration time. CKAN checks this field to ensure the token is still valid. If the token has expired, CKAN uses the <strong>Refresh Token</strong> to obtain a new Access Token.</li>
</ol>
<h4 id="token-refresh-process"><strong>Token Refresh Process</strong>:<a class="headerlink" href="#token-refresh-process" title="Permanent link">&para;</a></h4>
<ul>
<li>If the access token is expired but the refresh token is still valid, CKAN sends a <strong>Token Refresh Request</strong> to Keycloak to get a new access token.</li>
<li>If both the access token and refresh token are invalid, CKAN will delete the session and the user is redirected to the login page.</li>
</ul>
<h4 id="optimizations">Optimizations:<a class="headerlink" href="#optimizations" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Caching Public Keys</strong>: CKAN caches the public keys fetched from Keycloak to reduce the number of requests to Keycloak’s JWKS endpoint.</li>
<li><strong>Asynchronous Public Key Fetching</strong>: CKAN fetches the public keys asynchronously to prevent blocking the main thread.</li>
</ul>
<hr />
<h3 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Login</strong>: The user is redirected to Keycloak, authenticates, and returns to CKAN with tokens that are stored in a session. The session is maintained using a <code>session_id</code> cookie.</li>
<li><strong>User Verification (Identify)</strong>: On each request, CKAN verifies the user by checking the session, validating the access token, and potentially refreshing it if expired.</li>
<li><strong>Logout</strong>: The session is destroyed in CKAN, and the user is logged out from both CKAN and Keycloak. The session cookie is removed.</li>
</ul>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/ALTERNATIVE-EU" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/ALTERNATIVE_EU" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.sections", "navigation.expand", "search.suggest", "search.highlight", "content.tabs.link", "content.code.copy", "toc.follow"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
        <script src="../../../javascripts/extra.js"></script>
      
    
  </body>
</html>